<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="DataDAO">

	<select id="selectDataList"
		parameterType="egovframework.let.bbs.dta.vo.DataVO"
		resultType="egovframework.let.bbs.dta.vo.DataVO">

		SELECT
			NTT_ID AS nttId,
			BBS_ID AS bbsId,
			SUBJECT AS subject,
			CONTENT AS content,
			VIEW_CNT AS viewCnt,
			FRST_REGISTER_ID AS frstRegisterId,
			TO_CHAR(FRST_REGIST_PNTTM, 'YYYY-MM-DD') AS frstRegistPnttm,
			ATCH_FILE_ID AS atchFileId
		FROM COMTNBBS
		WHERE BBS_ID = #{bbsId}
			AND DEL_AT = 'N'
			AND USE_AT = 'Y'
			AND PINNED_AT = 'N'

		<if test="searchKeyword != null and searchKeyword != ''">
			<choose>
				<when test="searchCondition == '0'">
					AND SUBJECT LIKE '%' || #{searchKeyword} || '%'
				</when>
				<when test="searchCondition == '1'">
					AND CONTENT LIKE '%' || #{searchKeyword} || '%'
				</when>
				<when test="searchCondition == '2'">
					AND FRST_REGISTER_ID LIKE '%' || #{searchKeyword} || '%'
				</when>
			</choose>
		</if>

		ORDER BY FRST_REGIST_PNTTM DESC
        <![CDATA[
            OFFSET #{firstIndex} ROWS
            FETCH NEXT #{recordCountPerPage} ROWS ONLY
        ]]>
	</select>

	<select id="selectDataListCnt" parameterType="egovframework.let.bbs.dta.vo.DataVO" resultType="int">

		SELECT COUNT(*)
		FROM COMTNBBS
		WHERE BBS_ID = #{bbsId}
			AND DEL_AT = 'N'
			AND USE_AT = 'Y'
			AND PINNED_AT = 'N'
	</select>
</mapper>